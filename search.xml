<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Yarn Register Dns 端口冲突</title>
      <link href="/2019/01/29/yarn-register-dns/"/>
      <url>/2019/01/29/yarn-register-dns/</url>
      
        <content type="html"><![CDATA[<p>如果在安装时看到与YARN Registry DNS Bind Port相关的错误。可以参考以下步骤操作：</p><h2 id="1、打开Ambari管理界面并进入YARN管理界面"><a href="#1、打开Ambari管理界面并进入YARN管理界面" class="headerlink" title="1、打开Ambari管理界面并进入YARN管理界面"></a>1、打开Ambari管理界面并进入YARN管理界面</h2><p><img src="/2019/01/29/yarn-register-dns/Users/hongtao/Documents/GitHub/myblog/source/_data/picture/yarn-register-dns1.png" alt=""></p><h2 id="2、点击CONFIGS，进入配置界面"><a href="#2、点击CONFIGS，进入配置界面" class="headerlink" title="2、点击CONFIGS，进入配置界面"></a>2、点击CONFIGS，进入配置界面</h2><p><img src="/2019/01/29/yarn-register-dns/Users/hongtao/Documents/GitHub/myblog/source/_data/picture/yarn-register-dns2.png" alt=""></p><h2 id="3、点击ADVANCED进入高级设置中修改DNS端口号"><a href="#3、点击ADVANCED进入高级设置中修改DNS端口号" class="headerlink" title="3、点击ADVANCED进入高级设置中修改DNS端口号"></a>3、点击ADVANCED进入高级设置中修改DNS端口号</h2><p><img src="/2019/01/29/yarn-register-dns/Users/hongtao/Documents/GitHub/myblog/source/_data/picture/yarn-register-dns3.png" alt=""></p><p><strong>将53修改成其他不被占用的端口即可</strong></p><h2 id="4、重启集群，YARN正常启动"><a href="#4、重启集群，YARN正常启动" class="headerlink" title="4、重启集群，YARN正常启动"></a>4、重启集群，YARN正常启动</h2><p>参考文献：<a href="https://community.hortonworks.com/articles/225841/yarn-registry-dns-port-conflict-issue.html" target="_blank" rel="noopener">Hortonworks</a></p>]]></content>
      
      
      <categories>
          
          <category> HDP安装报错 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HDP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDP安装——基础环境配置</title>
      <link href="/2019/01/29/hdp-an-zhuang-ji-chu-pei-zhi/"/>
      <url>/2019/01/29/hdp-an-zhuang-ji-chu-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="一、下载安装包"><a href="#一、下载安装包" class="headerlink" title="一、下载安装包"></a>一、下载安装包</h2><p><strong>注：安装centos7时，安装英文版，避免环境安装时报错</strong></p><table><thead><tr><th style="text-align:left"><strong>ambari</strong></th><th><strong><a href="http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.7.3.0/ambari-2.7.3.0-centos7.tar.gz" target="_blank" rel="noopener">http://public-repo-1.hortonworks.com/ambari/centos7/2.x/updates/2.7.3.0/ambari-2.7.3.0-centos7.tar.gz</a></strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>HDP</strong></td><td><strong><a href="http://public-repo-1.hortonworks.com/HDP/centos7/3.x/updates/3.1.0.0/HDP-3.1.0.0-centos7-rpm.tar.gz" target="_blank" rel="noopener">http://public-repo-1.hortonworks.com/HDP/centos7/3.x/updates/3.1.0.0/HDP-3.1.0.0-centos7-rpm.tar.gz</a></strong></td></tr><tr><td style="text-align:left"><strong>HDP-UTILS</strong></td><td><strong><a href="http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/centos7/HDP-UTILS-1.1.0.22-centos7.tar.gz" target="_blank" rel="noopener">http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.22/repos/centos7/HDP-UTILS-1.1.0.22-centos7.tar.gz</a></strong></td></tr><tr><td style="text-align:left"><strong>HDP-GPL</strong></td><td><strong><a href="http://public-repo-1.hortonworks.com/HDP-GPL/centos7/3.x/updates/3.1.0.0/HDP-GPL-3.1.0.0-centos7-gpl.tar.gz" target="_blank" rel="noopener">http://public-repo-1.hortonworks.com/HDP-GPL/centos7/3.x/updates/3.1.0.0/HDP-GPL-3.1.0.0-centos7-gpl.tar.gz</a></strong></td></tr></tbody></table><hr><h2 id="二、系统环境配置"><a href="#二、系统环境配置" class="headerlink" title="二、系统环境配置"></a>二、系统环境配置</h2><p><strong>所有操作都是root用户</strong></p><h3 id="1、修改主机名"><a href="#1、修改主机名" class="headerlink" title="1、修改主机名"></a>1、修改主机名</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上vim /etc/hostname</code></pre><pre class=" language-shell"><code class="language-shell">master01 #主机名称</code></pre><h3 id="2、修改网络"><a href="#2、修改网络" class="headerlink" title="2、修改网络"></a>2、修改网络</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上vim /etc/sysconfig/network-scripts/ifcfg-enp0s31f6 #ifcfg-enp0s31f6 为网卡名称</code></pre><pre class=" language-shell"><code class="language-shell">BOOTPROTO="static"          # 使用静态IP地址，默认为dhcpIPADDR="192.168.0.80"       # 设置的静态IP地址NETMASK="255.255.255.0"     # 子网掩码GATEWAY="192.168.0.1"       # 网关地址DNS1="8.8.8.8"               # DNS服务器ONBOOT="yes"                 #是否开机启用</code></pre><h3 id="3、配置hosts文件"><a href="#3、配置hosts文件" class="headerlink" title="3、配置hosts文件"></a>3、配置hosts文件</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上vi /etc/hosts</code></pre><pre class=" language-shell"><code class="language-shell">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6192.168.0.80 master01192.168.0.81 node01192.168.0.82 node02</code></pre><h3 id="4、关闭防火墙"><a href="#4、关闭防火墙" class="headerlink" title="4、关闭防火墙"></a>4、关闭防火墙</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上systemctl disable firewalldsystemctl stop firewalld</code></pre><h3 id="5、设置SSH免密登陆"><a href="#5、设置SSH免密登陆" class="headerlink" title="5、设置SSH免密登陆"></a>5、设置SSH免密登陆</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上ssh-keygen 三下回车ssh-copy-id master01ssh-copy-id node01ssh-copy-id node02</code></pre><h3 id="6、检查DNS和NSCD"><a href="#6、检查DNS和NSCD" class="headerlink" title="6、检查DNS和NSCD"></a>6、检查DNS和NSCD</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上setenforce 0    #临时设置 重启失效</code></pre><pre class=" language-shell"><code class="language-shell">#在所有机器上vim /etc/selinux/config    #永久有效 需重启机器SELINUX=disabled</code></pre><pre class=" language-shell"><code class="language-shell">#在所有机器上umask 0022    #临时设置 重启失效echo umask 0022 >> /etc/profile    #永久有效 重启生效umask #检查当前机器的umask码</code></pre><h3 id="7、修改文件打开限制"><a href="#7、修改文件打开限制" class="headerlink" title="7、修改文件打开限制"></a>7、修改文件打开限制</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上vim /etc/security/limits.conf#在文件最后# End of file* soft nofile 65536* hard nofile 65536* soft nproc 131072* hard nproc 131072</code></pre><h3 id="8、同步时钟"><a href="#8、同步时钟" class="headerlink" title="8、同步时钟"></a>8、同步时钟</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtimeyum -y install ntp#在主服务器上vim /etc/ntp.conf#在文件中配置restrict default nomodify notrap nopeer noqueryserver 127.127.1.0fudge 127.127.1.0 stratum 10#在子节点中crontab -e0-59/10 * * * * /usr/sbin/ntpdate master01#在所有节点启动服务systemctl start ntpdsystemctl enable ntpd</code></pre><h3 id="9、安装JDK"><a href="#9、安装JDK" class="headerlink" title="9、安装JDK"></a>9、安装JDK</h3><h4 id="Ⅰ、先安装openjdk"><a href="#Ⅰ、先安装openjdk" class="headerlink" title="Ⅰ、先安装openjdk"></a>Ⅰ、<strong>先安装openjdk</strong></h4><p>​            安装openjdk解决包依赖的问题</p><pre class=" language-shell"><code class="language-shell">#在所有机器上yum -y install java</code></pre><h4 id="Ⅱ、卸载openjdk"><a href="#Ⅱ、卸载openjdk" class="headerlink" title="Ⅱ、卸载openjdk"></a>Ⅱ、卸载openjdk</h4><p>​        卸载jdk包，但是保留依赖包</p><pre class=" language-shell"><code class="language-shell">#在所有机器上rpm -qa|grep javayum remove java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64</code></pre><h4 id="Ⅲ、安装开源JDK"><a href="#Ⅲ、安装开源JDK" class="headerlink" title="Ⅲ、安装开源JDK"></a>Ⅲ、安装开源JDK</h4><pre class=" language-shell"><code class="language-shell">#在所有机器上#下载jdkwget https://download.oracle.com/otn-pub/java/jdk/8u201-b09/42970487e3af4f5aa5bca3f542482c60/jdk-8u201-linux-x64.rpm?AuthParam=1548732196_c3d078fb7f78308027532d04a26b4612#重命名mv jdk-8u201-linux-x64.rpm?AuthParam=1548732196_c3d078fb7f78308027532d04a26b4612 jdk-8u201-linux-x64.rpm#安装jdkrpm -ivh jdk-8u201-linux-x64.rpm#检查jdk版本java -versionjava version "1.8.0_201"Java(TM) SE Runtime Environment (build 1.8.0_201-b09)Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)#修改配置文件export JAVA_HOME=/usr/java/jdk1.8.0_201-amd64export CLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jar export PATH=$JAVA_HOME/bin:$PATH</code></pre><h3 id="10、安装MySQL"><a href="#10、安装MySQL" class="headerlink" title="10、安装MySQL"></a>10、安装MySQL</h3><p><strong>默认是PostgreSQL，但是在生产环境中不建议使用，所以安装mysql或其他，mysql安装在主节点上，如有需要可以安装在其他节点上</strong></p><h4 id="Ⅰ、卸载原来的MySQL"><a href="#Ⅰ、卸载原来的MySQL" class="headerlink" title="Ⅰ、卸载原来的MySQL"></a>Ⅰ、卸载原来的MySQL</h4><pre class=" language-shell"><code class="language-shell">rpm -qa|grep -i mysql #查看是否安装mysqlyum remove …     #卸载mysql所有内容find / -name mysql    #查找mysql所有文件位置rm -rf /var/lib/mysql…    #删除mysql相关文件rm -rf /var/log/mysql.log #删除该日志文件</code></pre><h4 id="Ⅱ、下载安装MySQL5-6"><a href="#Ⅱ、下载安装MySQL5-6" class="headerlink" title="Ⅱ、下载安装MySQL5.6"></a>Ⅱ、下载安装MySQL5.6</h4><pre class=" language-shell"><code class="language-shell">wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpmrpm -ivh mysql-community-release-el7-5.noarch.rpmyum install mysql-server    #安装mysqlsystemctl start mysqld    #启动mysqlsystemctl enable mysqld    #开机启动</code></pre><h4 id="Ⅲ、修改默认密码"><a href="#Ⅲ、修改默认密码" class="headerlink" title="Ⅲ、修改默认密码"></a>Ⅲ、修改默认密码</h4><pre class=" language-shell"><code class="language-shell">mysql -u root -p (无密码)use mysqlselect host,user,password from user;delete from user where user='';update user set host='%' where user='localhost';    #(如果无user=localhost 可不执行这条命令)update user set password=PASSWORD('123456') where host='%'    #(这条命令是根据上条执行)update user set password=PASSWORD('123456') where user='root' and host='localhost';update user set password=PASSWORD('123456') where user='root' and host='master';    #(可选操作，master01为主机名)grant all privileges on *.* to 'root'@'%' identified by '123456' with grant option;    #(远程连接数据库权限设置)flush privileges;     #要刷新权限</code></pre><h2 id="三、修改yum源，实现离线安装"><a href="#三、修改yum源，实现离线安装" class="headerlink" title="三、修改yum源，实现离线安装"></a>三、修改yum源，实现离线安装</h2><h3 id="1、安装httpd"><a href="#1、安装httpd" class="headerlink" title="1、安装httpd"></a>1、安装httpd</h3><pre class=" language-shell"><code class="language-shell">#在master01上执行yum -y install httpdservice httpd restartsystemctl enable httpd</code></pre><h3 id="2、修改安装文件位置"><a href="#2、修改安装文件位置" class="headerlink" title="2、修改安装文件位置"></a>2、修改安装文件位置</h3><pre class=" language-shell"><code class="language-shell">#在master01上执行cd /var/www/html/mkdir ambari#解压文件tar -xvzf ambari-2.7.3.0-centos7.tar.gztar -xvzf HDP-3.1.0.0-centos7-rpm.tar.gztar -xvzf HDP-GPL-3.1.0.0-centos7-gpl.tar.gztar -xvzf HDP-UTILS-1.1.0.22-centos7.tar.gz#打开http://192.168.0.80/ambari 查看是否有结果</code></pre><h3 id="3、制作本地源"><a href="#3、制作本地源" class="headerlink" title="3、制作本地源"></a>3、制作本地源</h3><pre class=" language-shell"><code class="language-shell">#在master01上执行#创建源目录yum install yum-utils createrepo yum-plugin-priorities -ycreaterepo  ./</code></pre><pre class=" language-shell"><code class="language-shell">#在master01上执行#修改ambari安装包源配置cd /var/www/html/ambari/ambari/centos7/2.7.3.0-139vim ambari.repo#VERSION_NUMBER=2.7.3.0-139[ambari-2.7.3.0]#json.url = http://public-repo-1.hortonworks.com/HDP/hdp_urlinfo.jsonname=ambari Version - ambari-2.7.3.0baseurl=http://192.168.0.80/ambari/ambari/centos7/2.7.3.0-139gpgcheck=1gpgkey=http://192.168.0.80/ambari/ambari/centos7/2.7.3.0-139/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1</code></pre><pre class=" language-shell"><code class="language-shell">#在master01上执行#修改HDP配置文件cd /var/www/html/ambari/HDP/centos7/3.1.0.0-78vim hdp.repo#VERSION_NUMBER=3.1.0.0-78[HDP-3.1.0.0]name=HDP Version - HDP-3.1.0.0baseurl=http://192.168.0.80/ambari/HDP/centos7/3.1.0.0-78gpgcheck=1gpgkey=http://192.168.0.80/ambari/HDP/centos7/3.1.0.0-78/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1[HDP-UTILS-1.1.0.22]name=HDP-UTILS Version - HDP-UTILS-1.1.0.22baseurl=http://192.168.0.80/ambari/HDP-UTILS/centos7/1.1.0.22gpgcheck=1gpgkey=http://192.168.0.80/ambari/HDP-UTILS/centos7/1.1.0.22/RPM-GPG-KEY/RPM-GPG-KEY-Jenkinsenabled=1priority=1</code></pre><h3 id="4、将repo文件辅助到YUM库"><a href="#4、将repo文件辅助到YUM库" class="headerlink" title="4、将repo文件辅助到YUM库"></a>4、将repo文件辅助到YUM库</h3><pre class=" language-shell"><code class="language-shell">#在master01上执行cp /var/www/html/ambari/ambari/centos7/2.7.3.0-139/ambari.repo /etc/yum.repos.d/cp /var/www/html/ambari/HDP/centos7/3.1.0.0-78/hdp.repo /etc/yum.repos.d/</code></pre><h3 id="5、将文件拷贝到子节点"><a href="#5、将文件拷贝到子节点" class="headerlink" title="5、将文件拷贝到子节点"></a>5、将文件拷贝到子节点</h3><pre class=" language-shell"><code class="language-shell">#在master01上执行scp /etc/yum.repos.d/ambari.repo node01:/etc/yum.repos.d/scp /etc/yum.repos.d/ambari.repo node02:/etc/yum.repos.d/scp /etc/yum.repos.d/hdp.repo node01:/etc/yum.repos.d/scp /etc/yum.repos.d/hdp.repo node02:/etc/yum.repos.d/</code></pre><h3 id="6、重新设置YUM缓存"><a href="#6、重新设置YUM缓存" class="headerlink" title="6、重新设置YUM缓存"></a>6、重新设置YUM缓存</h3><pre class=" language-shell"><code class="language-shell">#在所有机器上执行yum clean allyum makecache</code></pre><h2 id="四、安装ambari-server"><a href="#四、安装ambari-server" class="headerlink" title="四、安装ambari-server"></a>四、安装ambari-server</h2><h3 id="1、在MySQL中创建用户和数据库"><a href="#1、在MySQL中创建用户和数据库" class="headerlink" title="1、在MySQL中创建用户和数据库"></a>1、在MySQL中创建用户和数据库</h3><pre class=" language-shell"><code class="language-shell">#根据安装软件需要自己选择要创建的数据库和用户CREATE DATABASE ambari;  use ambari;  CREATE USER 'ambari'@'%' IDENTIFIED BY '123456';  GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'%';  CREATE USER 'ambari'@'localhost' IDENTIFIED BY '123456';  GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'localhost';  CREATE USER 'ambari'@'master01' IDENTIFIED BY '123456';  GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'master01';  FLUSH PRIVILEGES;  CREATE DATABASE hive;  use hive;  CREATE USER 'hive'@'%' IDENTIFIED BY 'hive';  GRANT ALL PRIVILEGES ON *.* TO 'hive'@'%';  CREATE USER 'hive'@'localhost' IDENTIFIED BY 'hive';  GRANT ALL PRIVILEGES ON *.* TO 'hive'@'localhost';  CREATE USER 'hive'@'master01' IDENTIFIED BY 'hive';  GRANT ALL PRIVILEGES ON *.* TO 'hive'@'master01';  FLUSH PRIVILEGES;  CREATE DATABASE oozie;  use oozie;  CREATE USER 'oozie'@'%' IDENTIFIED BY 'oozie';  GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'%';  CREATE USER 'oozie'@'localhost' IDENTIFIED BY 'oozie';  GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'localhost';  CREATE USER 'oozie'@'master01' IDENTIFIED BY 'oozie';  GRANT ALL PRIVILEGES ON *.* TO 'oozie'@'master01';  FLUSH PRIVILEGES;  </code></pre><h3 id="2、将jar包放入环境"><a href="#2、将jar包放入环境" class="headerlink" title="2、将jar包放入环境"></a>2、将jar包放入环境</h3><pre class=" language-shell"><code class="language-shell">#下载mysql-connector-java-5.1.47.tar.gzcd /datawget https://cdn.mysql.com//Downloads/Connector-J/mysql-connector-java-5.1.47.tar.gztar -xvzf mysql-connector-java-5.1.47.tar.gzcp /data/mysql-connector-java-5.1.47/mysql-connector-java-5.1.47* /usr/share/java/cd /usr/share/java/mv mysql-connector-java-5.1.47 mysql-connector-java.jarcp /usr/share/java/mysql-connector-java.jar /var/lib/ambari-server/resources/mysql-jdbc-driver.jar</code></pre><h3 id="3、初始化ambari-server并启动"><a href="#3、初始化ambari-server并启动" class="headerlink" title="3、初始化ambari-server并启动"></a>3、初始化ambari-server并启动</h3><pre class=" language-shell"><code class="language-shell">#初始化ambari-server setup --jdbc-db=mysql --jdbc-driver=/usr/share/java/mysql-connector-java.jar#所有选项选择y即可，当遇到如下选项时#配置JDK环境Checking JDK...Do you want to change Oracle JDK [y/n] (n)? y[1] Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8[2] Oracle JDK 1.7 + Java Cryptography Extension (JCE) Policy Files 7[3] Custom JDK==============================================================================Enter choice (1): 3如果上面选择3自定义JDK,则需要设置JAVA_HOME。输入：/usr/java/jdk1.8.0_201-amd64#配置数据库Configuring database...Enter advanced database configuration [y/n] (n)? yConfiguring database...==============================================================================Choose one of the following options:[1] - PostgreSQL (Embedded)[2] - Oracle[3] - MySQL[4] - PostgreSQL[5] - Microsoft SQL Server (Tech Preview)[6] - SQL Anywhere==============================================================================Enter choice (3): 3#设置数据库的具体配置信息，根据实际情况输入，如果和括号内相同，则可以直接回车。如果想重命名，就输入。Hostname (localhost):Port (3306):Database name (ambari):Username (ambari):Enter Database Password (bigdata):    123456    #创建用户时设置的密码Re-Enter password: 123456</code></pre><p>检查mysql中是否有新建的表</p><pre class=" language-shell"><code class="language-shell">mysql -u root -p 123456use ambari;show tables;#如果表为空的话cd /var/lib/ambari-server/resources    #sql脚本位置myslq -u ambari -p 123456use ambari;source Ambari-DDL-MySQL-CREATE.sql;</code></pre><h3 id="4、错误处理"><a href="#4、错误处理" class="headerlink" title="4、错误处理"></a>4、错误处理</h3><p>如果出现错误，查看server日志，根据报错进行修改</p><pre class=" language-shell"><code class="language-shell">cat var/log/ambari-server/ambari-server.log</code></pre><p>也可以删除数据库重新配置</p><pre class=" language-shell"><code class="language-shell">ambari-server stopmysql -u root -p 123456drop database ambari;drop database hive;drop database oozie;#重新创建数据库</code></pre><h3 id="5、安装向导本地源库地址"><a href="#5、安装向导本地源库地址" class="headerlink" title="5、安装向导本地源库地址"></a>5、安装向导本地源库地址</h3><pre class=" language-shell"><code class="language-shell">#HDPhttp://192.168.0.80/ambari/HDP/centos7/3.1.0.0-78/#HDP-UTILShttp://192.168.0.80/ambari/HDP-UTILS/centos7/1.1.0.22/#HDP-GPLhttp://192.168.0.80/ambari/HDP-GPL/centos7/3.1.0.0-78/</code></pre>]]></content>
      
      
      <categories>
          
          <category> HDP安装配置 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HDP </tag>
            
            <tag> BigData </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
